# Generated by Django 5.2.7 on 2025-12-21 10:03

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='PartialLoad',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('name', models.CharField(help_text='Short code for this partial load. Will be displayed as the load pipeline name.', max_length=10, unique=True, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('description', models.CharField(blank=True, help_text='Optional description which purpose this partial load is meant for.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Partial Loads',
                'db_table': 'partial_load',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Person',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('email', models.EmailField(help_text='Email address. Used as the unique identifier of this person.', max_length=254, unique=True)),
                ('name', models.CharField(help_text='Full name of the person.', max_length=200)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'People',
                'db_table': 'person',
                'ordering': ['email'],
            },
        ),
        migrations.CreateModel(
            name='SourceDataset',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('schema_name', models.CharField(blank=True, help_text='The schema name this dataset resides on. Can be left empty if it is a default schema (eg. dbo in SQLServer).', max_length=50, null=True)),
                ('source_dataset_name', models.CharField(help_text='Original name of the source dataset.', max_length=100)),
                ('description', models.CharField(blank=True, help_text='Optional description of the business content in this dataset.', max_length=255, null=True)),
                ('integrate', models.BooleanField(default=True, help_text='Controls whether this source dataset is in scope for integration into the target platform (stage/rawcore/bizcore/etc.). Uncheck if the dataset is documented here but not yet ready or intentionally excluded from automated target generation.')),
                ('static_filter', models.CharField(blank=True, help_text="Static WHERE clause applied to all loads of this dataset. Used for permanent business or technical scoping. Example: is_deleted_flag = 0 AND country_code = 'DE'.", max_length=255, null=True)),
                ('incremental', models.BooleanField(default=False, help_text='If checked, an incremental load strategy will be applied. In this case, appropriate increment parameters have to be provided.')),
                ('increment_filter', models.CharField(blank=True, help_text='Template WHERE clause for incremental extraction. Use the placeholder {{DELTA_CUTOFF}} for the dynamic cutoff timestamp/date. Example: (last_update_ts >= {{DELTA_CUTOFF}} OR created_at >= {{DELTA_CUTOFF}}) AND is_deleted_flag = 0.', max_length=255, null=True)),
                ('manual_model', models.BooleanField(default=False, help_text='If checked: dataset is manually maintained, not fully auto-generated.')),
                ('distinct_select', models.BooleanField(default=False, help_text='If checked: SELECT DISTINCT is enforced during generation.')),
                ('generate_raw_table', models.BooleanField(default=None, help_text='If Unknown: inherit the setting on SourceSystem level. If Yes: force creation of a raw landing TargetDataset for this SourceDataset. If No: suppress creation of a raw landing TargetDataset.', null=True)),
                ('active', models.BooleanField(default=True, help_text='Indicates whether this dataset is still considered an active source in the originating system. If unchecked, the dataset is treated as retired (no new loads expected) but it remains in metadata for lineage, audit, and historical reference.')),
                ('retired_at', models.DateTimeField(blank=True, help_text='Auto-set when active is unchecked. Used for lineage and audit.', null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Source Datasets',
                'db_table': 'source_dataset',
                'ordering': ['source_system', 'schema_name', 'source_dataset_name'],
            },
        ),
        migrations.CreateModel(
            name='SourceColumn',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('source_column_name', models.CharField(help_text="Original source column name, eg. 'MANDT', 'VBELN'.", max_length=100)),
                ('ordinal_position', models.PositiveIntegerField(help_text='Column order within the dataset.')),
                ('source_datatype_raw', models.CharField(blank=True, help_text="Raw source datatype as reported by the source introspection (lossless). Example: 'bit', 'nvarchar(max)', 'decimal(18,2)'.", max_length=100, null=True)),
                ('datatype', models.CharField(choices=[('BIGINT', 'Big Integer'), ('BINARY', 'Binary'), ('BOOLEAN', 'Boolean'), ('DATE', 'Date'), ('DECIMAL', 'Decimal'), ('FLOAT', 'Float'), ('INTEGER', 'Integer'), ('JSON', 'JSON'), ('STRING', 'String'), ('TIME', 'Time'), ('TIMESTAMP', 'Timestamp'), ('UUID', 'UUID')], help_text='Logical / normalized datatype.', max_length=20)),
                ('max_length', models.PositiveIntegerField(blank=True, help_text='How many characters the field may have.', null=True)),
                ('decimal_precision', models.PositiveIntegerField(blank=True, help_text='If datatype decimal, the decimal precision of the column.', null=True)),
                ('decimal_scale', models.PositiveIntegerField(blank=True, help_text='If datatype decimal, the number of decimal places of the column.', null=True)),
                ('nullable', models.BooleanField(default=True, help_text='If checked, this column can be NULL in the source dataset.')),
                ('primary_key_column', models.BooleanField(default=False, help_text='If checked, this column is part of the natural/business key (not the surrogate key).')),
                ('referenced_source_dataset_name', models.CharField(blank=True, help_text="Name of the upstream source object this column refers to (e.g. table 'customer_master', API 'GET /customers'). Serves for information purposes, does not necessarily have to be integrated/modeled as a SourceDataset. Used for lineage suggestions and probable future FK generation.", max_length=100, null=True)),
                ('description', models.CharField(blank=True, help_text='Business description / semantic meaning of the column.', max_length=255, null=True)),
                ('integrate', models.BooleanField(default=False, help_text='Controls whether this source column is in scope for integration into the target model. Uncheck, if the column is not (yet) chosen for integration.')),
                ('pii_level', models.CharField(choices=[('none', 'No personal data'), ('personal_data', 'Personal data'), ('special_category_data', 'Special category personal data')], default='none', help_text='PII classification of this column, if applicable.', max_length=30)),
                ('remark', models.CharField(blank=True, help_text='Free-form notes.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('source_dataset', models.ForeignKey(help_text='The dataset this column belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='source_columns', to='metadata.sourcedataset')),
            ],
            options={
                'verbose_name_plural': 'Source Columns',
                'db_table': 'source_column',
                'ordering': ['source_dataset', 'ordinal_position'],
            },
        ),
        migrations.CreateModel(
            name='SourceDatasetGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('target_short_name', models.CharField(help_text='Short code used to derive the unified target table prefix. eg. sap for grouping sap1 and sap2.', max_length=10, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('unified_source_dataset_name', models.CharField(help_text='Unified name of the source object. May be one of the source datasets which participate in this group.', max_length=128)),
                ('description', models.CharField(blank=True, help_text='Optional description why the group was established.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ManyToManyField(blank=True, help_text='Optional governance owner definition. May be used as default owner for generated TargetDatasets.', related_name='source_dataset_groups', to='metadata.person')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Source Dataset Groups',
                'db_table': 'source_dataset_group',
                'ordering': ['target_short_name', 'unified_source_dataset_name'],
            },
        ),
        migrations.CreateModel(
            name='SourceDatasetGroupMembership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('is_primary_system', models.BooleanField(default=False, help_text="If checked, this dataset is considered the 'golden' / leading source for this group.")),
                ('source_identity_id', models.CharField(blank=True, help_text="Optional identifier used to distinguish rows when multiple source datasets are grouped (e.g. 'aw1', 'aw2'). If set, it can be used as additional business key component or as tie-breaker in incremental logic.", max_length=30, null=True)),
                ('source_identity_ordinal', models.PositiveIntegerField(blank=True, help_text='Optional priority score for this source within the group. Lower values mean higher priority. If not set, the default order uses is_primary_system and identity id.', null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('group', models.ForeignKey(help_text='The source dataset group. Only necessary to store if more than one source datasets should be grouped together.', on_delete=django.db.models.deletion.CASCADE, related_name='memberships', to='metadata.sourcedatasetgroup')),
                ('source_dataset', models.ForeignKey(help_text='The dataset to be assigned to the group.', on_delete=django.db.models.deletion.CASCADE, related_name='dataset_groups', to='metadata.sourcedataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'source_dataset_group_membership',
                'ordering': ['-is_primary_system', 'group', 'source_dataset'],
            },
        ),
        migrations.CreateModel(
            name='SourceDatasetIncrementPolicy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('environment', models.CharField(choices=[('dev', 'Development'), ('test', 'Test'), ('prod', 'Production')], help_text='Environment this policy applies to (e.g. dev, test, prod).', max_length=20)),
                ('increment_interval_length', models.PositiveIntegerField(help_text="How far to look back from 'now' for incremental loads in this environment.")),
                ('increment_interval_unit', models.CharField(choices=[('day', 'Day'), ('month', 'Month'), ('year', 'Year')], help_text='Unit for the increment interval length.', max_length=10)),
                ('active', models.BooleanField(default=True, help_text='If multiple rows exist (history), which one is currently active.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('source_dataset', models.ForeignKey(help_text='The dataset this policy applies to.', on_delete=django.db.models.deletion.CASCADE, related_name='increment_policies', to='metadata.sourcedataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'source_dataset_increment_policy',
                'ordering': ['source_dataset', 'environment'],
            },
        ),
        migrations.CreateModel(
            name='SourceDatasetOwnership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('role', models.CharField(choices=[('business', 'Business Owner'), ('steward', 'Data Steward'), ('technical', 'Technical Owner')], help_text='The role which the person has on the dataset.', max_length=20)),
                ('is_primary_owner', models.BooleanField(default=False, help_text='If checked, this is the primary ownership.')),
                ('since', models.DateField(blank=True, help_text='The date from which the ownership will start.', null=True)),
                ('until', models.DateField(blank=True, help_text='The date on which the ownership will end.', null=True)),
                ('remark', models.CharField(blank=True, help_text='Optional remarks concerning the ownership.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('person', models.ForeignKey(help_text='The person who is declared as owner of the dataset.', on_delete=django.db.models.deletion.PROTECT, related_name='source_dataset_ownerships', to='metadata.person')),
                ('source_dataset', models.ForeignKey(help_text='The dataset for which an owner is declared.', on_delete=django.db.models.deletion.CASCADE, related_name='source_dataset_ownerships', to='metadata.sourcedataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-is_primary_owner', 'source_dataset', 'role', 'since'],
            },
        ),
        migrations.AddField(
            model_name='sourcedataset',
            name='owner',
            field=models.ManyToManyField(blank=True, help_text='Declared business / technical owners with roles.', related_name='source_datasets', through='metadata.SourceDatasetOwnership', to='metadata.person'),
        ),
        migrations.CreateModel(
            name='System',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('short_name', models.CharField(help_text="Physical / concrete system identifier. eg. 'sap', 'nav', 'crm', 'ga4', 'dwhdev', 'dwh'.", max_length=10, unique=True, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('name', models.CharField(help_text='Identifying name of the system. Does not have technical consequences.', max_length=50)),
                ('description', models.CharField(blank=True, help_text='Business description / semantic meaning of the system.', max_length=255, null=True)),
                ('type', models.CharField(choices=[('redshift', 'Amazon Redshift'), ('s3', 'Amazon S3 Storage (manual, no reflection)'), ('azureblob', 'Azure Blob Storage (manual, no reflection)'), ('csv', 'CSV File(s) (manual, no reflection)'), ('clickhouse', 'ClickHouse (beta, limited reflection)'), ('databricks', 'Databricks SQL'), ('duckdb', 'DuckDB'), ('exasol', 'Exasol (manual, no reflection)'), ('excel', 'Excel / XLSX File(s) (manual, no reflection)'), ('bigquery', 'Google BigQuery'), ('gcs', 'Google Cloud Storage (manual, no reflection)'), ('graphql', 'GraphQL API (manual, no reflection)'), ('db2', 'IBM DB2 (manual, no reflection)'), ('json', 'JSON File(s) (manual, no reflection)'), ('jsonl', 'JSON Lines File(s) (manual, no reflection)'), ('mysql', 'MySQL / MariaDB'), ('oracle', 'Oracle'), ('parquet', 'Parquet File(s) (manual, no reflection)'), ('postgres', 'PostgreSQL'), ('presto', 'Presto (beta, limited reflection)'), ('rest', 'REST API (manual, no reflection)'), ('hana', 'SAP HANA (manual, no reflection)'), ('sapr3', 'SAP R/3 (manual, no reflection)'), ('sftp', 'SFTP Location (manual, no reflection)'), ('mssql', 'SQL Server'), ('sqlite', 'SQLite'), ('snowflake', 'Snowflake'), ('teradata', 'Teradata (manual, no reflection)'), ('trino', 'Trino (beta, limited reflection)')], help_text='System type / backend technology. Used for import and adapter logic.', max_length=20)),
                ('target_short_name', models.CharField(help_text="Stable business prefix for stage/rawcore naming (e.g. 'sap', 'crm', 'fi'). Primarily relevant for source-driven layers.", max_length=10, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('is_source', models.BooleanField(default=True, help_text='If checked, this system acts as a source (has datasets, ingestion, etc.).')),
                ('is_target', models.BooleanField(default=False, help_text='If checked, this system acts as a target platform (warehouse/lakehouse/etc.).')),
                ('include_ingest', models.CharField(choices=[('none', 'None'), ('external', 'External'), ('native', 'Native')], default='none', help_text='How/if this system participates in ingestion pipelines. Only relevant if is_source=True.', max_length=20)),
                ('generate_raw_tables', models.BooleanField(default=False, help_text="Default policy: create raw landing tables (TargetDatasets in schema 'raw') for all SourceDatasets in this system. Only relevant if is_source=True.")),
                ('active', models.BooleanField(default=True, help_text='System is still considered a live data source / target.')),
                ('retired_at', models.DateTimeField(blank=True, help_text='Automatically set when active is unchecked.', null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Systems',
                'db_table': 'system',
                'ordering': ['short_name'],
            },
        ),
        migrations.AddField(
            model_name='sourcedataset',
            name='source_system',
            field=models.ForeignKey(help_text='The system this dataset comes from (must have is_source=True).', limit_choices_to={'is_source': True}, on_delete=django.db.models.deletion.CASCADE, related_name='source_datasets', to='metadata.system'),
        ),
        migrations.CreateModel(
            name='TargetColumn',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('target_column_name', models.CharField(help_text="Final column name in snake_case. eg. 'customer_name', 'order_created_tms'.", max_length=63, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters, digits, and underscores. Max length is 63 characters.', regex='^[a-z][a-z0-9_]{0,62}$')])),
                ('ordinal_position', models.PositiveIntegerField(help_text='Column order within the dataset.')),
                ('datatype', models.CharField(choices=[('BIGINT', 'Big Integer'), ('BINARY', 'Binary'), ('BOOLEAN', 'Boolean'), ('DATE', 'Date'), ('DECIMAL', 'Decimal'), ('FLOAT', 'Float'), ('INTEGER', 'Integer'), ('JSON', 'JSON'), ('STRING', 'String'), ('TIME', 'Time'), ('TIMESTAMP', 'Timestamp'), ('UUID', 'UUID')], help_text='Logical / normalized datatype.', max_length=20)),
                ('max_length', models.PositiveIntegerField(blank=True, help_text='How many characters the field may have.', null=True)),
                ('decimal_precision', models.PositiveIntegerField(blank=True, help_text='If datatype decimal The decimal precision of the column.', null=True)),
                ('decimal_scale', models.PositiveIntegerField(blank=True, help_text='If datatype decimal, the number of decimal places of the column.', null=True)),
                ('nullable', models.BooleanField(default=True, help_text='Whether this column can be NULL in the final target dataset.')),
                ('system_role', models.CharField(blank=True, choices=[('', 'â€”'), ('business_key', 'Business key'), ('surrogate_key', 'Surrogate key'), ('foreign_key', 'Foreign key'), ('entity_key', 'Entity key'), ('row_hash', 'Row hash'), ('load_run_id', 'Load run id'), ('loaded_at', 'Loaded at timestamp'), ('version_started_at', 'Version started at'), ('version_ended_at', 'Version ended at'), ('version_state', 'Version state')], default='', help_text='Semantic role for system-managed columns. Used to reliably render/execute technical columns (e.g. load_run_id, loaded_at) and to support forensics without relying on naming conventions.', max_length=30)),
                ('artificial_column', models.BooleanField(default=False, help_text='If checked, this column does not directly exist in any single source, but is computed / harmonized / derived.')),
                ('manual_expression', models.TextField(blank=True, help_text='Optional expression for deriving this column.\n- If you use elevata DSL, wrap it in {{ ... }}, e.g. {{ UPPER(customer_name) }}.\n- If you enter plain SQL without {{ }}, it is treated as target-specific SQL and used directly in generated SQL / SQL preview.\nThis default applies to all inputs unless overridden at source level.', null=True)),
                ('description', models.CharField(blank=True, help_text='Business description / semantic meaning of the column.', max_length=255, null=True)),
                ('pii_level', models.CharField(choices=[('none', 'No personal data'), ('personal_data', 'Personal data'), ('special_category_data', 'Special category personal data')], default='none', help_text='PII classification of this column, if applicable.', max_length=30)),
                ('remark', models.CharField(blank=True, help_text='Free-form notes.', max_length=255, null=True)),
                ('sensitivity', models.CharField(choices=[('public', 'Public'), ('internal', 'Internal'), ('confidential', 'Confidential'), ('highly_confidential', 'Highly Confidential')], default='public', help_text='Sensitivity classification for this column (e.g. public, confidential, restricted).', max_length=30)),
                ('lineage_origin', models.CharField(choices=[('direct', 'Direct'), ('derived', 'Derived'), ('lookup_join', 'Lookup Join'), ('constant', 'Constant'), ('surrogate_key', 'Surrogate Key'), ('foreign_key', 'Foreign Key')], default='direct', help_text='How this column is derived: direct source field, derived calculation, lookup join, constant, etc.', max_length=20)),
                ('surrogate_expression', models.TextField(blank=True, help_text='Platform-neutral expression used to generate the surrogate key (e.g. hash256).', null=True)),
                ('profiling_stats', models.JSONField(blank=True, help_text='Optional summarized profiling statistics for this column, stored as JSON. Use valid JSON syntax (key-value pairs). Example: {"null_rate": 0.02, "distinct_count": 123, "top_values": ["A", "B", "C"]}', null=True)),
                ('active', models.BooleanField(default=True, help_text='If unchecked, this column is deprecated. It remains in metadata for lineage and documentation but should not be generated, deployed, or used for new models.')),
                ('retired_at', models.DateTimeField(blank=True, help_text='Optional timestamp when this column was marked as inactive. Automatically set when active is unchecked.', null=True)),
                ('lineage_key', models.CharField(blank=True, db_index=True, help_text='Stable technical key used by the generator to identify this column by its source lineage instead of its physical name. Ensures that renaming target_column_name does not create duplicates.', max_length=255, null=True)),
                ('is_system_managed', models.BooleanField(default=False, help_text='If checked, this column is managed by the system and core attributes are locked.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Target Columns',
                'db_table': 'target_column',
                'ordering': ['target_dataset', 'ordinal_position'],
            },
        ),
        migrations.CreateModel(
            name='TargetColumnInput',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('manual_expression', models.TextField(blank=True, help_text='Optional expression that applies ONLY when using this specific source column.\n- Prefer elevata DSL wrapped in {{ ... }} for generation.\n- If you enter plain SQL without {{ }}, it may be used directly in SQL preview for this input.\nIf empty, the TargetColumn.manual_expression (or a direct column reference) is used.', null=True)),
                ('ordinal_position', models.PositiveIntegerField(default=1, help_text='Priority / fallback order when multiple source systems feed the same target column. 1 = highest priority.')),
                ('active', models.BooleanField(default=True, help_text='If unchecked, kept for lineage/history but ignored going forward.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('source_column', models.ForeignKey(blank=True, help_text='The original source column feeding this target column.', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='output_links', to='metadata.sourcecolumn')),
                ('target_column', models.ForeignKey(help_text='The target column being populated.', on_delete=django.db.models.deletion.CASCADE, related_name='input_links', to='metadata.targetcolumn')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('upstream_target_column', models.ForeignKey(blank=True, help_text='If set, this target column is fed from another target column instead of a raw source column.', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='downstream_column_inputs', to='metadata.targetcolumn')),
            ],
            options={
                'db_table': 'target_column_input',
                'ordering': ['target_column', 'ordinal_position'],
            },
        ),
        migrations.AddField(
            model_name='targetcolumn',
            name='source_columns',
            field=models.ManyToManyField(blank=True, help_text='Which source columns contribute to this target column.', related_name='mapped_target_columns', through='metadata.TargetColumnInput', through_fields=('target_column', 'source_column'), to='metadata.sourcecolumn'),
        ),
        migrations.AddField(
            model_name='targetcolumn',
            name='upstream_columns',
            field=models.ManyToManyField(blank=True, help_text='Which other target columns feed this target column as upstream instead of source columns.', related_name='downstream_columns', through='metadata.TargetColumnInput', through_fields=('target_column', 'upstream_target_column'), to='metadata.targetcolumn'),
        ),
        migrations.CreateModel(
            name='TargetDataset',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('target_dataset_name', models.CharField(help_text="Final dataset (table/view) name, snake_case. eg. 'sap_customer', 'sap_sales_order'.", max_length=63, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters, digits, and underscores. Max length is 63 characters.', regex='^[a-z][a-z0-9_]{0,62}$')])),
                ('description', models.CharField(blank=True, help_text='Business description / semantic meaning of the dataset.', max_length=255, null=True)),
                ('handle_deletes', models.BooleanField(default=True, help_text='Whether deletes in the source should be reflected in this dataset.')),
                ('historize', models.BooleanField(default=True, help_text='Track slowly changing state / valid_from / valid_to, etc.')),
                ('combination_mode', models.CharField(choices=[('single', 'Single upstream (no combination)'), ('union', 'Union of multiple upstream datasets')], default='single', help_text="How multiple upstream datasets are combined in the pipeline. 'single' = one upstream, 'union' = append all upstreams.", max_length=20)),
                ('biz_entity_role', models.CharField(blank=True, choices=[('core_entity', 'Core entity'), ('fact', 'Fact table'), ('dimension', 'Dimension'), ('reference', 'Reference / master data')], help_text='Semantic role of this dataset in the BizCore model. Examples: core_entity, fact, dimension, reference.', max_length=30, null=True)),
                ('biz_grain_note', models.CharField(blank=True, help_text="Human-readable description of the business grain. Example: 'one row per customer and today', 'one row per contract and day'.", max_length=255, null=True)),
                ('incremental_strategy', models.CharField(choices=[('full', 'Full load (truncate + reload)'), ('append', 'Append-only incremental load'), ('merge', 'Merge (upsert by business key, handle deletes)'), ('snapshot', 'Snapshot-based load')], default='full', help_text='How this dataset is loaded.\n- full: always full refresh (truncate + reload)\n- append: append-only incremental load\n- merge: upsert by business key and handle deletes\n- snapshot: periodic snapshots by watermark/date', max_length=20)),
                ('manual_model', models.BooleanField(default=False, help_text='If checked: dataset is manually maintained, not fully auto-generated.')),
                ('distinct_select', models.BooleanField(default=False, help_text='If checked: SELECT DISTINCT is enforced during generation.')),
                ('data_filter', models.CharField(blank=True, help_text='Optional row-level filter to restrict records.', max_length=255, null=True)),
                ('materialization_type', models.CharField(blank=True, choices=[('table', 'table'), ('view', 'view'), ('incremental', 'incremental'), ('external_passthrough', 'external_passthrough')], help_text='If set, overrides target_schema.default_materialization_type for this dataset. If null, dataset inherits the schema default.', max_length=30, null=True)),
                ('sensitivity', models.CharField(choices=[('public', 'Public'), ('internal', 'Internal'), ('confidential', 'Confidential'), ('highly_confidential', 'Highly Confidential')], default='public', help_text='Confidentiality / sensitivity level for this dataset.', max_length=30)),
                ('access_intent', models.CharField(blank=True, choices=[('internal_reporting', 'Internal Reporting'), ('analytics', 'Analytics / BI'), ('ml_training', 'Machine Learning / AI'), ('compliance', 'Regulatory / Compliance'), ('exploration', 'Ad-hoc Exploration'), ('integration', 'System Integration')], help_text='Intended usage for governance purposes, e.g. analytics, finance_reporting, ml_feature_store.', max_length=30, null=True)),
                ('active', models.BooleanField(default=True, help_text='If unchecked, this dataset is deprecated. It remains in metadata for lineage and documentation but should not be generated, deployed, or used for new models.')),
                ('retired_at', models.DateTimeField(blank=True, help_text='Optional timestamp when this dataset was marked as inactive. Automatically set when active gets unchecked.', null=True)),
                ('lineage_key', models.CharField(blank=True, db_index=True, help_text='Stable technical key used by the generator to identify this dataset by its source lineage instead of its physical name. Ensures that renaming target_dataset_name does not create duplicates.', max_length=255, null=True)),
                ('is_system_managed', models.BooleanField(default=False, help_text='If checked, this dataset is managed by the system and core attributes are locked.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('incremental_source', models.ForeignKey(blank=True, help_text="If set, this target dataset inherits incremental window logic (and delete detection scope) from the referenced SourceDataset. The referenced dataset's increment_filter defines which records are considered 'in scope' for delta load & delete detection.", null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incremental_targets', to='metadata.sourcedataset')),
                ('partial_load', models.ManyToManyField(blank=True, db_table='target_dataset_partial_load', help_text='Optional subset extraction definitions (per environment / window).', related_name='datasets', to='metadata.partialload')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Target Datasets',
                'db_table': 'target_dataset',
                'ordering': ['target_schema', 'target_dataset_name'],
            },
        ),
        migrations.AddField(
            model_name='targetcolumn',
            name='target_dataset',
            field=models.ForeignKey(help_text='The dataset this column belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='target_columns', to='metadata.targetdataset'),
        ),
        migrations.CreateModel(
            name='TargetDatasetInput',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('role', models.CharField(choices=[('primary', 'Primary (golden source)'), ('enrichment', 'Enrichment (same entity, more attributes)'), ('reference_lookup', 'Reference Lookup / Code table'), ('audit_only', 'Audit / Technical Metadata only')], help_text='How this source contributes to the target: primary (golden source), enrichment (same entity extra attrs), reference_lookup (dim/code join), or audit_only (technical metadata).', max_length=50)),
                ('active', models.BooleanField(default=True, help_text='If unchecked, this mapping is retained for lineage/audit but is no longer used for load.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('source_dataset', models.ForeignKey(blank=True, help_text='The source dataset contributing to this target dataset.', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='output_links', to='metadata.sourcedataset')),
                ('target_dataset', models.ForeignKey(help_text='The stage/rawcore/bizcore dataset being built.', on_delete=django.db.models.deletion.CASCADE, related_name='input_links', to='metadata.targetdataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('upstream_target_dataset', models.ForeignKey(blank=True, help_text='If set, this target dataset is used as upstream instead of a source dataset.', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='downstream_input_links', to='metadata.targetdataset')),
            ],
            options={
                'db_table': 'target_dataset_input',
            },
        ),
        migrations.AddField(
            model_name='targetdataset',
            name='source_datasets',
            field=models.ManyToManyField(blank=True, help_text='Which source datasets feed this target dataset. Used for multi-source consolidation, staging, rawcore integration, etc.', related_name='target_datasets', through='metadata.TargetDatasetInput', through_fields=('target_dataset', 'source_dataset'), to='metadata.sourcedataset'),
        ),
        migrations.AddField(
            model_name='targetdataset',
            name='upstream_datasets',
            field=models.ManyToManyField(blank=True, help_text='Which other target dataset feed this target dataset as upstream instead of source datasets.', related_name='downstream_datasets', through='metadata.TargetDatasetInput', through_fields=('target_dataset', 'upstream_target_dataset'), to='metadata.targetdataset'),
        ),
        migrations.CreateModel(
            name='TargetDatasetOwnership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('role', models.CharField(choices=[('business', 'Business Owner'), ('steward', 'Data Steward'), ('technical', 'Technical Owner')], help_text='The role which the person has on the dataset.', max_length=20)),
                ('is_primary_owner', models.BooleanField(default=False, help_text='If checked, this is the primary ownership.')),
                ('since', models.DateField(blank=True, help_text='The date from which the ownership will start.', null=True)),
                ('until', models.DateField(blank=True, help_text='The date on which the ownership will end.', null=True)),
                ('remark', models.CharField(blank=True, help_text='Optional remarks concerning the ownership.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('person', models.ForeignKey(help_text='The person who has the ownership for the dataset.', on_delete=django.db.models.deletion.PROTECT, related_name='target_dataset_ownerships', to='metadata.person')),
                ('target_dataset', models.ForeignKey(help_text='The dataset for which an owner is declared.', on_delete=django.db.models.deletion.CASCADE, related_name='target_dataset_ownerships', to='metadata.targetdataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-is_primary_owner', 'target_dataset', 'role', 'since'],
            },
        ),
        migrations.AddField(
            model_name='targetdataset',
            name='owner',
            field=models.ManyToManyField(blank=True, help_text='Declared business / technical owners with roles.', related_name='target_datasets', through='metadata.TargetDatasetOwnership', to='metadata.person'),
        ),
        migrations.CreateModel(
            name='TargetDatasetReference',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('reference_prefix', models.CharField(blank=True, help_text="If provided, forms the FK name in the child as <prefix>_<referenced_dataset>_key. Example: prefix 'billing' + referenced 'sap_customer' -> 'billing_sap_customer_key'.", max_length=10, null=True, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('relationship_type', models.CharField(choices=[('n_to_1', 'n to 1'), ('1_to_n', '1 to n'), ('1_to_1', '1 to 1'), ('n_to_m', 'n to m (future)')], default='n_to_1', help_text='Type of relationship of this reference.', max_length=20)),
                ('join_condition_hint', models.CharField(blank=True, help_text="Human/machine-readable join hint for lineage visualization. Example: 'child.billing_sap_customer_key = parent.sap_customer_key'.", max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('referenced_dataset', models.ForeignKey(help_text='Parent dataset that defines the business entity / surrogate PK.', on_delete=django.db.models.deletion.CASCADE, related_name='incoming_references', to='metadata.targetdataset')),
                ('referencing_dataset', models.ForeignKey(help_text='Child dataset that holds the foreign key.', on_delete=django.db.models.deletion.CASCADE, related_name='outgoing_references', to='metadata.targetdataset')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Target Dataset References',
                'db_table': 'target_dataset_reference',
                'ordering': ['referencing_dataset', 'reference_prefix', 'referenced_dataset'],
            },
        ),
        migrations.CreateModel(
            name='TargetDatasetReferenceComponent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('ordinal_position', models.PositiveIntegerField(default=1, help_text='Order for composite keys.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('from_column', models.ForeignKey(help_text='Column on the referencing (child) dataset.', on_delete=django.db.models.deletion.PROTECT, related_name='fk_components_outgoing', to='metadata.targetcolumn')),
                ('reference', models.ForeignKey(help_text='The parent-child relationship this mapping belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='key_components', to='metadata.targetdatasetreference')),
                ('to_column', models.ForeignKey(help_text='Column on the referenced (parent) dataset.', on_delete=django.db.models.deletion.PROTECT, related_name='fk_components_incoming', to='metadata.targetcolumn')),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Target Reference Components',
                'db_table': 'target_reference_key_component',
                'ordering': ['reference', 'ordinal_position'],
            },
        ),
        migrations.CreateModel(
            name='TargetSchema',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('short_name', models.CharField(help_text="Logical layer identifier. Examples: 'raw', 'stage', 'rawcore', 'bizcore', 'serving'. Defines architectural intent and default behavior.", max_length=10, unique=True, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('display_name', models.CharField(help_text="Human-readable name, e.g. 'Business Core', 'Serving Layer'.", max_length=50)),
                ('description', models.CharField(blank=True, help_text='Purpose of this layer and what transformations are allowed here.', max_length=255, null=True)),
                ('database_name', models.CharField(help_text='Target database / catalog on the destination platform.', max_length=100, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters, digits, and underscores. Max length is 63 characters.', regex='^[a-z][a-z0-9_]{0,62}$')])),
                ('schema_name', models.CharField(help_text='Physical schema / namespace on the destination platform. Defaults to short_name, but can differ if platform naming conventions require it.', max_length=10, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('physical_prefix', models.CharField(blank=True, help_text="Optional physical naming prefix for datasets in this schema, eg. 'raw', 'stg', 'rc'. Will be prepended like '<prefix>_<sys>_<obj>'. If empty, no prefix will be added.", max_length=10, null=True, validators=[django.core.validators.RegexValidator(message='Must start with a lowercase letter and contain only lowercase letters and digits. Max length is 10 characters.', regex='^[a-z][a-z0-9]{0,9}$')])),
                ('generate_layer', models.BooleanField(default=True, help_text='If checked, datasets for this layer are generated automatically from source metadata (e.g. raw, stage, rawcore). Uncheck for curated layers (e.g. bizcore, serving).')),
                ('consolidate_groups', models.BooleanField(default=False, help_text='If true, datasets from multiple source systems may be merged/grouped into one physical dataset in this schema.')),
                ('is_user_visible', models.BooleanField(default=True, help_text='If unchecked, this layer is internal/technical and hidden in normal UIs.')),
                ('default_materialization_type', models.CharField(choices=[('table', 'table'), ('view', 'view'), ('incremental', 'incremental'), ('external_passthrough', 'external_passthrough')], default='table', help_text='Default materialization strategy for datasets in this layer.', max_length=30)),
                ('default_historize', models.BooleanField(default=True, help_text='Whether datasets in this layer are expected to track history / SCD-style state.')),
                ('incremental_strategy_default', models.CharField(choices=[('full', 'Full load (truncate + reload)'), ('append', 'Append-only incremental load'), ('merge', 'Merge (upsert by business key, handle deletes)'), ('snapshot', 'Snapshot-based load')], default='full', help_text='Default incremental loading strategy for datasets in this schema when the source is incremental. For non-incremental sources, a full refresh is always used.', max_length=20)),
                ('sensitivity_default', models.CharField(choices=[('public', 'Public'), ('internal', 'Internal'), ('confidential', 'Confidential'), ('highly_confidential', 'Highly Confidential')], default='public', help_text='Default sensitivity classification for datasets in this schema (e.g. public, confidential).', max_length=30)),
                ('access_intent_default', models.CharField(blank=True, choices=[('internal_reporting', 'Internal Reporting'), ('analytics', 'Analytics / BI'), ('ml_training', 'Machine Learning / AI'), ('compliance', 'Regulatory / Compliance'), ('exploration', 'Ad-hoc Exploration'), ('integration', 'System Integration')], help_text='Default usage intent for governance purposes: analytics, finance_reporting, operations, ml_feature_store, etc.', max_length=30, null=True)),
                ('surrogate_keys_enabled', models.BooleanField(default=True, help_text='If checked, this layer is expected to generate deterministic surrogate keys for its primary entities. If unchecked, no surrogate keys will be generated.')),
                ('surrogate_key_algorithm', models.CharField(default='sha256', help_text='Hash algorithm used for deterministic surrogate keys in this layer.', max_length=20)),
                ('surrogate_key_null_token', models.CharField(default='null_replaced', help_text='Token to use instead of NULL in natural key components.', max_length=50)),
                ('surrogate_key_pair_separator', models.CharField(default='~', help_text='Separator between field name and value within one component.', max_length=5)),
                ('surrogate_key_component_separator', models.CharField(default='|', help_text='Separator between components in the natural key string.', max_length=5)),
                ('pepper_strategy', models.CharField(default='runtime_pepper', help_text='How pepper is injected at runtime. No pepper value is stored in metadata.', max_length=50)),
                ('is_system_managed', models.BooleanField(default=False, help_text='If checked, this schema is managed by the system and core attributes are locked.')),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Target Schemas',
                'db_table': 'target_schema',
                'ordering': ['short_name'],
            },
        ),
        migrations.AddField(
            model_name='targetdataset',
            name='target_schema',
            field=models.ForeignKey(help_text='Defines physical DB/schema, default materialization and governance expectations.', on_delete=django.db.models.deletion.PROTECT, related_name='target_datasets', to='metadata.targetschema'),
        ),
        migrations.CreateModel(
            name='Team',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('name', models.CharField(help_text='Name of the team, eg. Sales, Finance, ...', max_length=30, unique=True)),
                ('description', models.CharField(blank=True, help_text='Optional description of the team.', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Teams',
                'db_table': 'team',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='person',
            name='team',
            field=models.ManyToManyField(blank=True, db_table='team_person', help_text='The team(s) the person is assigned to.', related_name='persons', to='metadata.team'),
        ),
        migrations.AddConstraint(
            model_name='sourcecolumn',
            constraint=models.UniqueConstraint(fields=('source_dataset', 'source_column_name'), name='unique_source_column'),
        ),
        migrations.AddConstraint(
            model_name='sourcecolumn',
            constraint=models.UniqueConstraint(fields=('source_dataset', 'ordinal_position'), name='unique_source_column_position'),
        ),
        migrations.AddConstraint(
            model_name='sourcedatasetgroupmembership',
            constraint=models.UniqueConstraint(fields=('group', 'source_dataset'), name='unique_group_membership'),
        ),
        migrations.AddConstraint(
            model_name='sourcedatasetincrementpolicy',
            constraint=models.UniqueConstraint(fields=('source_dataset', 'environment', 'active'), name='unique_active_increment_policy_per_env'),
        ),
        migrations.AddConstraint(
            model_name='sourcedatasetownership',
            constraint=models.UniqueConstraint(fields=('source_dataset', 'person', 'role'), name='unique_source_dataset_ownership'),
        ),
        migrations.AddConstraint(
            model_name='sourcedataset',
            constraint=models.UniqueConstraint(fields=('source_system', 'schema_name', 'source_dataset_name'), name='unique_source_dataset'),
        ),
        migrations.AddConstraint(
            model_name='targetcolumninput',
            constraint=models.UniqueConstraint(fields=('target_column', 'source_column', 'upstream_target_column'), name='unique_target_column_input_source'),
        ),
        migrations.AddConstraint(
            model_name='targetcolumninput',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('source_column__isnull', False), ('upstream_target_column__isnull', True)), models.Q(('source_column__isnull', True), ('upstream_target_column__isnull', False)), _connector='OR'), name='td_input_exactly_one_column_upstream'),
        ),
        migrations.AddConstraint(
            model_name='targetcolumn',
            constraint=models.UniqueConstraint(fields=('target_dataset', 'target_column_name'), name='unique_target_column'),
        ),
        migrations.AddConstraint(
            model_name='targetcolumn',
            constraint=models.UniqueConstraint(fields=('target_dataset', 'ordinal_position'), name='unique_target_column_position'),
        ),
        migrations.AddConstraint(
            model_name='targetdatasetinput',
            constraint=models.UniqueConstraint(fields=('target_dataset', 'source_dataset', 'upstream_target_dataset'), name='unique_source_per_target_dataset'),
        ),
        migrations.AddConstraint(
            model_name='targetdatasetinput',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('source_dataset__isnull', False), ('upstream_target_dataset__isnull', True)), models.Q(('source_dataset__isnull', True), ('upstream_target_dataset__isnull', False)), _connector='OR'), name='td_input_exactly_one_upstream'),
        ),
        migrations.AddConstraint(
            model_name='targetdatasetownership',
            constraint=models.UniqueConstraint(fields=('target_dataset', 'person', 'role'), name='unique_target_dataset_ownership'),
        ),
        migrations.AddConstraint(
            model_name='targetdatasetreference',
            constraint=models.UniqueConstraint(fields=('referencing_dataset', 'reference_prefix', 'referenced_dataset'), name='unique_target_dataset_reference'),
        ),
        migrations.AddConstraint(
            model_name='targetdatasetreferencecomponent',
            constraint=models.UniqueConstraint(fields=('reference', 'from_column', 'to_column'), name='unique_reference_parent_key_component'),
        ),
        migrations.AddConstraint(
            model_name='targetdataset',
            constraint=models.UniqueConstraint(fields=('target_schema', 'target_dataset_name'), name='unique_target_dataset_per_schema'),
        ),
    ]

<!--
elevata - Metadata-driven Data Platform Framework
Copyright © 2025 Ilona Tag

This file is part of elevata.

elevata is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of
the License, or (at your option) any later version.

elevata is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with elevata. If not, see <https://www.gnu.org/licenses/>.

Contact: <https://github.com/elevata-labs/elevata>.
-->

{% extends "base.html" %}
{% load attr %}

{% block title %}{{ object }} · elevata{% endblock %}

{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">{{ title|default:object }}</h1>
    <a class="btn btn-secondary" href="{% url model_name|add:'_list' %}">Back</a>
  </div>

  <table class="table table-striped align-middle mb-4">
    <tbody>
      {% for field in fields %}
        <tr>
          <th style="width: 25%;">{{ field.verbose_name|capfirst }}</th>
          <td>{{ object|attr:field.name }}</td>
        </tr>
      {% endfor %}

      {% for field in many_to_many %}
        <tr>
          <th style="width: 25%;">{{ field.verbose_name|capfirst }}</th>
          <td>
            {% with rel_mgr=object|attr:field.name %}
              {% for rel_obj in rel_mgr.all %}
                {{ rel_obj }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                <span class="text-muted">–</span>
              {% endfor %}
            {% endwith %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if related_objects %}
    <h5 class="mt-4 mb-3">Related Data</h5>
    {% for label, items in related_objects %}
      <div class="mb-3">
        <strong>{{ label }}</strong>
        {% if items %}
          <ul class="mb-0">
            {% for item in items %}
              <li>{{ item }}</li>
            {% empty %}
              <li><em>No related records</em></li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">–</p>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
{% endblock %}
